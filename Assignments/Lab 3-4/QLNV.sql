CREATE DATABASE QLNV;
USE QLNV;

--Q1
CREATE TABLE PHONG(
	MAPHONG char(3),
	TENPHONG nvarchar(40),
	DIACHI nvarchar(50),
	TEL char(10),
	
	PRIMARY KEY(MAPHONG)
)

CREATE TABLE DMNN(
	MANN char(2),
	TENNN nvarchar(20),
	
	PRIMARY KEY(MANN)
)

CREATE TABLE NHANVIEN(
	MANV char(5),
	HOTEN nvarchar(40),
	GIOITINH nvarchar(3),
	NGAYSINH date,
	LUONG int,
	MAPHONG char(3),
	SDT char(10),
	NGAYBC date,

	PRIMARY KEY(MANV)
)

CREATE TABLE TDNN(
	MANV char(5),
	MANN char(2),
	TDO char(1),

	PRIMARY KEY(MANV,MANN)
)

--Q2
--PHONG
INSERT INTO PHONG(MAPHONG,TENPHONG,DIACHI,TEL) VALUES('HCA',N'Hành chính tổ hợp', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8585793')
INSERT INTO PHONG(MAPHONG,TENPHONG,DIACHI,TEL) VALUES('KDA',N'Kinh doanh', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8574943')
INSERT INTO PHONG(MAPHONG,TENPHONG,DIACHI,TEL) VALUES('KTA',N'Kỹ thuật', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 9480485')
INSERT INTO PHONG(MAPHONG,TENPHONG,DIACHI,TEL) VALUES('QTA',N'Quản trị', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8508585')
INSERT INTO PHONG(MAPHONG,TENPHONG,DIACHI,TEL) VALUES('BVA',N'Bảo vệ', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8508586')
--SELECT * FROM PHONG
--DMNN
INSERT INTO DMNN(MANN, TENNN) VALUES('01', 'Anh')
INSERT INTO DMNN(MANN, TENNN) VALUES('02', 'Nga')
INSERT INTO DMNN(MANN, TENNN) VALUES('03', N'Pháp')
INSERT INTO DMNN(MANN, TENNN) VALUES('04', N'Nhật')
INSERT INTO DMNN(MANN, TENNN) VALUES('05', N'Trung Quốc')
INSERT INTO DMNN(MANN, TENNN) VALUES('06', N'Hàn Quốc')

--NHANVIEN
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('HC001',N'Nguyễn Thị Hà',N'Nữ', '08/27/1950',2500000,'HCA',null,'02/08/1975')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('HC002',N'Trần Văn Nam','Nam', '06/12/1975',3000000,'HCA',null,'06/08/1997')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('HC003',N'Nguyễn Thanh Huyền',N'Nữ', '07/03/1987',1500000,'HCA',null,'09/24/1999')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KD001',N'Lê Tuyết Anh',N'Nữ', '02/03/1977',2500000,'KDA',null,'10/02/2001')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KD002',N'Nguyễn Anh Tú','Nam', '07/04/1942',2600000,'KDA',null,'09/24/1999')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KD003',N'Phạm An Thái','Nam', '05/09/1977',1600000,'KDA',null,'09/24/1999')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KD004',N'Lê Văn Hải','Nam', '01/02/1976',2700000,'KDA',null,'06/08/1997')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KD005',N'Nguyễn Phương Minh','Nam', '01/02/1980',2000000,'KDA',null,'10/02/2001')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT001',N'Trần Đình Khâm','Nam', '12/02/1981',2700000,'KTA',null,'01/01/2005')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT002',N'Nguyễn Mạnh Hùng','Nam','08/16/1980',2300000,'KTA',null,'01/01/2005')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT003',N'Phạm Thanh Sơn','Nam','08/20/1984',2000000,'KTA',null,'01/01/2005')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT004',N'Vũ Thị Hoài',N'Nữ','12/05/1980',2500000,'KTA',null,'10/02/2001')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT005',N'Nguyễn Thu Lan',N'Nữ', '10/05/1977',3000000,'KTA',null,'10/02/2001')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT006',N'Trần Hoài Nam','Nam', '07/02/1978',2800000,'KTA',null,'06/08/1997')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT007',N'Hoàng Nam Sơn','Nam', '12/03/1940',3000000,'KTA',null,'07/02/1965')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT008',N'Lê Thu Trang',N'Nữ', '07/06/1950',2500000,'KTA',null,'08/02/1968')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT009',N'Khúc Nam Hải','Nam', '07/22/1980',2000000,'KTA',null,'01/01/2005')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT010',N'Phùng Trung Dũng','Nam', '08/28/1978',2200000,'KTA',null, '09/24/1999')
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('KT011',N'Unknown','Nam', '08/28/2001',2200000,null,null, '09/24/2003')
--TDNN
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('HC001','01','A')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('HC001','02','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('HC002','01','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('HC002','03','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('HC003','01','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD001','01','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD001','02','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD002','01','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD002','02','A')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD003','02','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD003','01','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD004','01','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD004','04','A')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD004','05','A')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD005','01','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD005','02','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD005','03','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KD005','04','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT001','01','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT001','04','E')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT002','01','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT002','02','B')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT003','01','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT003','03','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT004','01','D')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('KT005','01','C')

--SELECT * FROM TDNN
--Q3
INSERT INTO NHANVIEN(MANV,HOTEN,GIOITINH,NGAYSINH,LUONG,MAPHONG,SDT,NGAYBC) VALUES('QT001',N'Phan Quốc Tùng', 'Nam', CONVERT(date,'10-09-1997'),150000,'QTA','',CONVERT(date, GETDATE()))
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('QT001','01','C')
INSERT INTO TDNN(MANV,MANN,TDO) VALUES('QT001','04','A')
--1
SELECT * FROM NHANVIEN WHERE MANV='KT001'
--3
SELECT * FROM NHANVIEN WHERE GIOITINH = N'Nữ'
--4
SELECT * FROM NHANVIEN WHERE HOTEN LIKE N'Nguyễn%'
--5
SELECT * FROM NHANVIEN WHERE HOTEN LIKE N'%Văn%'
--6
SELECT *,YEAR(GETDATE())-YEAR(NGAYSINH) AS TUOI FROM NHANVIEN WHERE YEAR(GETDATE())-YEAR(NGAYSINH)<30
--7
SELECT *,YEAR(GETDATE())-YEAR(NGAYSINH) AS TUOI FROM NHANVIEN WHERE YEAR(GETDATE())-YEAR(NGAYSINH) BETWEEN 25 AND 30
--8
SELECT MANV FROM TDNN WHERE MANN='01' AND TDO='C'
--9
SELECT * FROM NHANVIEN WHERE YEAR(NGAYBC)<2000
--10
SELECT * FROM NHANVIEN WHERE YEAR(GETDATE())-YEAR(NGAYBC)>10
--11
SELECT * FROM NHANVIEN WHERE (GIOITINH = 'Nam' AND YEAR(GETDATE())-YEAR(NGAYSINH)>=60) OR (GIOITINH=N'Nữ' AND YEAR(GETDATE())-YEAR(NGAYSINH)>=55)
--12
SELECT MAPHONG,TENPHONG, TEL FROM PHONG
--13
SELECT TOP 2 HOTEN, NGAYSINH, NGAYBC FROM NHANVIEN 
--14
SELECT MANV,HOTEN,NGAYSINH,LUONG FROM NHANVIEN WHERE LUONG BETWEEN 2000000 AND 3000000
--15
SELECT * FROM NHANVIEN WHERE SDT IS NULL
--16
SELECT * FROM NHANVIEN WHERE MONTH(NGAYSINH)=3
--17
SELECT * FROM NHANVIEN ORDER BY LUONG
--18
SELECT r.TENPHONG AS PHONG, AVG(LUONG) AS LUONG_TB 
FROM NHANVIEN s,PHONG r
WHERE s.MAPHONG=r.MAPHONG AND r.TENPHONG='Kinh Doanh' 
GROUP BY r.TENPHONG
--19
SELECT r.TENPHONG AS PHONG, COUNT(*) AS SL_NV, AVG(s.LUONG) AS LUONG_TB
FROM NHANVIEN s, PHONG r
WHERE s.MAPHONG=r.MAPHONG AND r.TENPHONG='Kinh Doanh'
GROUP BY r.TENPHONG
--20
SELECT r.TENPHONG AS PHONG, SUM(LUONG) AS TONG_LUONG
FROM NHANVIEN s, PHONG r
WHERE s.MAPHONG=r.MAPHONG
GROUP BY r.TENPHONG
--21
SELECT r.TENPHONG AS PHONG, SUM(LUONG) AS TONG_LUONG
FROM NHANVIEN s, PHONG r
WHERE s.MAPHONG=r.MAPHONG
GROUP BY r.TENPHONG
HAVING SUM(LUONG)>5000000
--22
SELECT s.MANV,s.HOTEN,r.MAPHONG,r.TENPHONG 
FROM NHANVIEN s, PHONG r
WHERE s.MAPHONG=r.MAPHONG
--23
SELECT s.*,r.TENPHONG,r.DIACHI,r.TEL 
FROM NHANVIEN s
LEFT OUTER JOIN PHONG r ON s.MAPHONG=r.MAPHONG
--24
SELECT s.*,r.TENPHONG,r.DIACHI,r.TEL
FROM NHANVIEN s
RIGHT OUTER JOIN PHONG r ON s.MAPHONG=r.MAPHONG

